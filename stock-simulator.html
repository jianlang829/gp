<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ’° æ¨¡æ‹Ÿè‚¡ç¥¨å¤§å¸ˆ - è™šæ‹ŸæŠ•èµ„æ¸¸æˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            background: #f5f7fa;
            color: #333;
        }

        #app {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }

        .stat {
            text-align: center;
            margin: 15px 0;
            font-size: 1.2em;
            font-weight: bold;
        }

        .stat span {
            color: #e74c3c;
        }

        hr {
            border: 0;
            border-top: 1px solid #eee;
            margin: 25px 0;
        }

        .stock-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fafafa;
        }

        .stock-info h3 {
            margin: 0 0 5px 0;
            color: #2c3e50;
        }

        .stock-price {
            font-weight: bold;
            color: #27ae60;
        }

        .stock-price.down {
            color: #e74c3c;
        }

        button {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
        }

        .buy {
            background: #27ae60;
            color: white;
        }

        .sell {
            background: #e74c3c;
            color: white;
        }

        .portfolio-section h3 {
            margin-top: 20px;
            color: #2c3e50;
        }

        .portfolio-item {
            padding: 10px;
            margin: 8px 0;
            background: #f0f7ff;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }

        .news {
            background: #fffde7;
            padding: 12px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
            font-size: 0.95em;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.85em;
        }
    </style>
</head>

<body>
    <div id="app">
        <h1>ğŸ’° æ¨¡æ‹Ÿè‚¡ç¥¨å¤§å¸ˆ</h1>
        <div class="stat">ä½ æœ‰ï¼š<span id="cash">$100,000</span></div>
        <div class="stat">æ€»èµ„äº§ï¼š<span id="total">$100,000</span></div>

        <div class="news" id="news">ğŸ¯ ä»Šæ—¥æ–°é—»ï¼šç§‘æŠ€è‚¡è¿æ¥æ–°ä¸€æ³¢ä¸Šæ¶¨æµªæ½®ï¼</div>

        <hr>
        <h3>ğŸ“ˆ å¯äº¤æ˜“è‚¡ç¥¨ï¼ˆå®æ—¶æ•°æ®ï¼‰</h3>
        <div id="stocks"></div>

        <hr>
        <div class="portfolio-section">
            <h3>ğŸ’¼ æˆ‘çš„æŒä»“</h3>
            <div id="portfolio">
                <p>æš‚æ— æŒä»“</p>
            </div>
        </div>

        <div class="footer">
            âš ï¸ è¿™æ˜¯æ¨¡æ‹Ÿæ¸¸æˆï¼Œä¸æ¶‰åŠçœŸå®æŠ•èµ„ã€‚ä»…ä¾›å­¦ä¹ å¨±ä¹ã€‚
        </div>
    </div>

    <script>
        // ==================== é…ç½®åŒº ====================
        const stocks = [
            { symbol: 'AAPL', name: 'è‹¹æœ' },
            { symbol: 'TSLA', name: 'ç‰¹æ–¯æ‹‰' },
            { symbol: 'NVDA', name: 'è‹±ä¼Ÿè¾¾' },
            { symbol: 'MSFT', name: 'å¾®è½¯' },
            { symbol: 'GOOGL', name: 'è°·æ­Œ' },
            { symbol: 'AMZN', name: 'äºšé©¬é€Š' },
            { symbol: 'META', name: 'Meta' },
            { symbol: 'AMD', name: 'è¶…å¨åŠå¯¼ä½“' }
        ];

        // éšæœºæ–°é—»æ± 
        const newsPool = [
            "ç§‘æŠ€è‚¡è¿æ¥æ–°ä¸€æ³¢ä¸Šæ¶¨æµªæ½®ï¼",
            "ç¾è”å‚¨æš—ç¤ºå¯èƒ½é™æ¯ï¼Œå¸‚åœºæƒ…ç»ªä¹è§‚",
            "æŸå…¬å¸å‘å¸ƒé©å‘½æ€§AIäº§å“ï¼Œè‚¡ä»·æš´æ¶¨ï¼",
            "èƒ½æºä»·æ ¼é£™å‡ï¼Œæ–°èƒ½æºæ¿å—å—ç›Š",
            "CEOçªå‘è¾èŒï¼Œå…¬å¸è‚¡ä»·ä¸‹è·Œ15%",
            "å…¨çƒä¾›åº”é“¾æ”¹å–„ï¼Œåˆ¶é€ ä¸šå›æš–",
            "æ¯”ç‰¹å¸çªç ´7ä¸‡ç¾å…ƒï¼ŒåŠ å¯†æ¦‚å¿µè‚¡è·Ÿæ¶¨",
            "ç»æµè¡°é€€æ‹…å¿§åŠ å‰§ï¼Œé˜²å¾¡æ€§è‚¡ç¥¨å—é’ç"
        ];

        let cash = 100000;
        let portfolio = {};
        let stockPrices = {};
        let lastNewsIndex = -1;

        // åŠ è½½æœ¬åœ°æ•°æ®
        if (localStorage.getItem('stockGame')) {
            const saved = JSON.parse(localStorage.getItem('stockGame'));
            cash = saved.cash || 100000;
            portfolio = saved.portfolio || {};
        }

        // è·å–éšæœºæ–°é—»ï¼ˆé¿å…é‡å¤ï¼‰
        function getRandomNews() {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * newsPool.length);
            } while (newIndex === lastNewsIndex && newsPool.length > 1);
            lastNewsIndex = newIndex;
            return newsPool[newIndex];
        }

        // æ›´æ–°æ–°é—»
        function updateNews() {
            document.getElementById('news').innerText = getRandomNews();
        }

        // è·å–è‚¡ä»·ï¼ˆä½¿ç”¨ Yahoo Finance å…è´¹æ¥å£ï¼‰
        async function fetchStockPrice(symbol) {
            try {
                const res = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1m`);
                const data = await res.json();
                const price = data.chart.result?.[0]?.meta?.regularMarketPrice;
                return price ? price : 0;
            } catch (e) {
                console.warn(`è·å– ${symbol} å¤±è´¥`, e);
                // è¿”å›ä¸€ä¸ªåˆç†èŒƒå›´å†…çš„éšæœºå€¼ä½œä¸ºå…œåº•
                return Math.floor(Math.random() * 150) + 50;
            }
        }

        // æ›´æ–°ç•Œé¢
        function updateUI() {
            document.getElementById('cash').innerText = '$' + cash.toLocaleString();

            const totalValue = cash + Object.keys(portfolio).reduce((sum, sym) => {
                const price = stockPrices[sym] || 0;
                return sum + (portfolio[sym] * price);
            }, 0);
            document.getElementById('total').innerText = '$' + totalValue.toLocaleString();

            // æ¸²æŸ“è‚¡ç¥¨åˆ—è¡¨
            const stocksEl = document.getElementById('stocks');
            stocksEl.innerHTML = stocks.map(stock => {
                const price = stockPrices[stock.symbol] || 0;
                const isUp = price > (stockPrices.last?.[stock.symbol] || 0);
                const priceClass = isUp ? '' : 'down';
                stockPrices.last = { ...stockPrices.last, [stock.symbol]: price };

                return `
          <div class="stock-item">
            <div class="stock-info">
              <h3>${stock.symbol} (${stock.name})</h3>
              <p>å½“å‰ä»·ï¼š<span class="stock-price ${priceClass}">$${price.toFixed(2)}</span></p>
            </div>
            <div>
              <button class="buy" onclick="buy('${stock.symbol}', ${price})">ä¹°å…¥</button>
              <button class="sell" onclick="sell('${stock.symbol}', ${price})">å–å‡º</button>
            </div>
          </div>
        `;
            }).join('');

            // æ¸²æŸ“æŒä»“
            const portfolioEl = document.getElementById('portfolio');
            if (Object.keys(portfolio).length === 0) {
                portfolioEl.innerHTML = '<p>æš‚æ— æŒä»“</p>';
            } else {
                portfolioEl.innerHTML = Object.entries(portfolio).map(([sym, qty]) => {
                    const price = stockPrices[sym] || 0;
                    const value = qty * price;
                    return `<div class="portfolio-item">${sym}: ${qty}è‚¡ Â· æ€»å€¼ $${value.toFixed(2)}</div>`;
                }).join('');
            }

            // æ£€æŸ¥æ˜¯å¦ç›ˆåˆ©ï¼ˆç¬¬ä¸€æ¬¡ç›ˆåˆ©å¼¹çª—ï¼‰
            const total = parseFloat(document.getElementById('total').innerText.replace(/[^0-9.-]+/g, ''));
            if (total > 100000 && !localStorage.getItem('firstProfit')) {
                alert("ğŸ‰ æ­å–œï¼ä½ ç¬¬ä¸€æ¬¡èµšåˆ°é’±äº†ï¼è¿™å°±æ˜¯å¤åˆ©çš„åŠ›é‡ï¼");
                localStorage.setItem('firstProfit', 'true');
            }
        }

        // ä¹°å…¥å‡½æ•°
        window.buy = function (symbol, price) {
            const amount = prompt("è¯·è¾“å…¥è´­ä¹°æ•°é‡ï¼š", "1");
            if (!amount || isNaN(amount) || amount <= 0) return;
            const cost = parseFloat(amount) * price;
            if (cost > cash) {
                alert("âŒ ä½™é¢ä¸è¶³ï¼");
                return;
            }
            cash -= cost;
            portfolio[symbol] = (portfolio[symbol] || 0) + parseInt(amount);
            saveGame();
            updateUI();
        };

        // å–å‡ºå‡½æ•°
        window.sell = function (symbol, price) {
            if (!portfolio[symbol] || portfolio[symbol] <= 0) {
                alert("âš ï¸ ä½ æ²¡æœ‰æŒæœ‰è¿™åªè‚¡ç¥¨ï¼");
                return;
            }
            const amount = prompt("è¯·è¾“å…¥å–å‡ºæ•°é‡ï¼š", portfolio[symbol]);
            if (!amount || isNaN(amount) || amount <= 0) return;
            if (parseInt(amount) > portfolio[symbol]) {
                alert("âš ï¸ ä½ æ²¡æœ‰è¿™ä¹ˆå¤šè‚¡ç¥¨ï¼");
                return;
            }
            const income = parseFloat(amount) * price;
            cash += income;
            portfolio[symbol] -= parseInt(amount);
            if (portfolio[symbol] <= 0) delete portfolio[symbol];
            saveGame();
            updateUI();
        };

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveGame() {
            localStorage.setItem('stockGame', JSON.stringify({ cash, portfolio }));
        }

        // åˆå§‹åŒ–
        async function init() {
            updateNews();
            setInterval(updateNews, 30000); // æ¯30ç§’æ¢ä¸€æ¡æ–°é—»

            for (let stock of stocks) {
                stockPrices[stock.symbol] = await fetchStockPrice(stock.symbol);
            }
            updateUI();

            // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡è‚¡ä»·
            setInterval(async () => {
                for (let stock of stocks) {
                    stockPrices[stock.symbol] = await fetchStockPrice(stock.symbol);
                }
                updateUI();
            }, 30000);
        }

        // å¯åŠ¨
        init();
    </script>
</body>

</html>